<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Holiday Hub</title>
    <link rel="stylesheet" href="styles/theme.css" />
  </head>
  <body>
    <a class="skip-link" href="#greetings">Skip to content</a>
    <header class="hero">
      <div class="parallax-scene" aria-hidden="true">
        <div class="sky layer" data-depth="0.1"></div>
        <div class="stars layer" data-depth="0.12"></div>
        <div class="hills layer" data-depth="0.2"></div>
        <div class="ribbon layer" data-depth="0.35"></div>
        <div class="foreground layer" data-depth="0.5"></div>
        <canvas id="snow-canvas" class="snow layer" data-depth="0.1"></canvas>
        <div class="snow-fallback" hidden>
          <div class="flake"></div>
          <div class="flake"></div>
          <div class="flake"></div>
          <div class="flake"></div>
          <div class="flake"></div>
        </div>
        <div class="bottle-3d" role="presentation" aria-hidden="true">
          <div class="bottle-body">
            <div class="bottle-label">Coca-Cola</div>
            <div class="bottle-cap"></div>
          </div>
        </div>
      </div>

      <picture class="hero-static-art" aria-hidden="true">
        <img
          src="assets/hero-static.svg"
          loading="lazy"
          decoding="async"
          alt="Illustration of snowy hills, ribbon, and a winter bottle silhouette"
        />
      </picture>

      <div class="container content">
        <p class="badge">Holiday lounge</p>
        <h1>Season's greetings</h1>
        <p>
          Gather around the digital fireplace for heartfelt cards, cozy
          mini-games, and a cheerful guestbook to share the joy.
        </p>
        <div class="actions">
          <a class="btn glow-accent" href="#games">Play mini-games</a>
          <a class="btn secondary" href="#guestbook">Sign the guestbook</a>
        </div>

        <div class="preference-bar frosted-panel" aria-label="Experience settings">
          <label class="toggle" for="reduced-motion-toggle">
            <input type="checkbox" id="reduced-motion-toggle" />
            <span>Use reduced-motion mode</span>
          </label>
          <label class="toggle" for="static-art-toggle">
            <input type="checkbox" id="static-art-toggle" />
            <span>Swap to static art</span>
          </label>
          <label class="toggle" for="mute-audio-toggle">
            <input type="checkbox" id="mute-audio-toggle" />
            <span>Mute audio and SFX</span>
          </label>
        </div>
      </div>
    </header>

    <main>
      <section class="section" id="greetings">
        <div class="container">
          <h2 class="section-title">Festive greetings</h2>
          <p class="section-subtitle">
            Swipe through cards and warm wishes from friends everywhere.
          </p>
          <div class="carousel-shell">
            <div class="carousel-toolbar frosted-panel" aria-label="Carousel settings">
              <div class="custom-card">
                <h3 class="card-title">Personalize a card</h3>
                <label class="sr-only" for="custom-name">Sender name</label>
                <input
                  id="custom-name"
                  name="custom-name"
                  type="text"
                  placeholder="Your name"
                  autocomplete="name"
                />
                <label class="sr-only" for="custom-message">Message</label>
                <textarea
                  id="custom-message"
                  name="custom-message"
                  rows="2"
                  placeholder="Your cozy wish"
                ></textarea>
                <button class="btn secondary" id="apply-card" type="button">
                  Update my card
                </button>
              </div>
              <div class="carousel-actions" aria-label="Playback and navigation">
                <div class="toggle-group">
                  <label class="toggle" for="chime-toggle">
                    <input type="checkbox" id="chime-toggle" checked />
                    <span>Gentle chime on slide change</span>
                  </label>
                  <p class="hint" id="preference-hint"></p>
                </div>
                <div class="nav-buttons">
                  <button class="btn tertiary" id="prev-slide" type="button" aria-label="Previous card">
                    â—€ Prev
                  </button>
                  <button class="btn tertiary" id="play-toggle" type="button" aria-pressed="true">
                    Pause autoplay
                  </button>
                  <button class="btn tertiary" id="next-slide" type="button" aria-label="Next card">
                    Next â–¶
                  </button>
                </div>
              </div>
            </div>

            <div class="carousel" aria-label="Holiday greeting cards">
              <div class="carousel-track" role="list" tabindex="0">
                <article class="card frosted-panel active" role="listitem" aria-label="Snowy wishes" tabindex="0">
                  <div class="snow-corners" aria-hidden="true"></div>
                  <h3 class="card-title">Snowy wishes</h3>
                  <p class="card-meta">From Jamie in Oslo</p>
                  <p>
                    May your cocoa stay warm and your playlists stay merry all
                    season long.
                  </p>
                </article>
                <article class="card frosted-panel" role="listitem" aria-label="Candy cane cheer" tabindex="-1">
                  <div class="snow-corners" aria-hidden="true"></div>
                  <h3 class="card-title">Candy cane cheer</h3>
                  <p class="card-meta">From Priya in Toronto</p>
                  <p>
                    Here's to board games, bright lights, and laughter that echoes
                    past midnight.
                  </p>
                </article>
                <article class="card frosted-panel" role="listitem" aria-label="Starlit skies" tabindex="-1">
                  <div class="snow-corners" aria-hidden="true"></div>
                  <h3 class="card-title">Starlit skies</h3>
                  <p class="card-meta">From Mateo in Quito</p>
                  <p>
                    Wishing you crisp nights, cozy blankets, and memories worth
                    framing.
                  </p>
                </article>
                <article class="card frosted-panel" role="listitem" aria-label="Your custom card" tabindex="-1" id="custom-card">
                  <div class="snow-corners" aria-hidden="true"></div>
                  <h3 class="card-title" id="custom-title">Your name here</h3>
                  <p class="card-meta" id="custom-meta">Personal touch</p>
                  <p id="custom-body">Share a cozy wish and see it shine.</p>
                </article>
              </div>
            </div>
          </div>
        </div>
      </section>

      <div class="ribbon-divider"><span>Holiday mini-games</span></div>

      <section class="section" id="games">
        <div class="container">
          <div class="games-header">
            <div>
              <h2 class="section-title">Mini-games lounge</h2>
              <p class="section-subtitle">
                Quick rounds of festive fun while the cocoa cools.
              </p>
            </div>
            <p class="hint" id="games-preference-hint">
              Toggle motion, static art, and audio in the hero settings above.
            </p>
          </div>
          <div class="games-grid" role="list">
            <article class="game-card glow-accent" role="listitem">
              <span class="badge">Arcade</span>
              <h3>Snowball Toss</h3>
              <p>Tap the moving targets, climb the score, and crank the cheer.</p>
              <button class="btn secondary launch" data-target="snowball-modal">
                Quick start
              </button>
            </article>
            <article class="game-card glow-accent" role="listitem">
              <span class="badge">Balance</span>
              <h3>Ornament Stacker</h3>
              <p>Land ornaments neatly before the stack tips over.</p>
              <button class="btn secondary launch" data-target="ornament-modal">
                Quick start
              </button>
            </article>
            <article class="game-card glow-accent" role="listitem">
              <span class="badge">Memory</span>
              <h3>Gift Matcher</h3>
              <p>Flip festive pairs, race the clock, and celebrate every match.</p>
              <button class="btn secondary launch" data-target="matcher-modal">
                Quick start
              </button>
            </article>
          </div>
        </div>
      </section>

      <div class="modal" id="snowball-modal" role="dialog" aria-modal="true" aria-labelledby="snowball-title" hidden>
        <div class="modal-panel frosted-panel">
          <div class="modal-header">
            <div>
              <p class="badge">Arcade</p>
              <h3 id="snowball-title">Snowball Toss</h3>
              <p class="section-subtitle">Tap or click moving targets to rack up points.</p>
            </div>
            <button class="btn tertiary close" type="button" data-target="snowball-modal" aria-label="Close Snowball Toss">Ã—</button>
          </div>
          <div class="game-shell">
            <div class="game-toolbar">
              <div class="scoreboard" aria-live="polite">
                <span>Score: <strong id="snowball-score">0</strong></span>
                <span>Streak: <strong id="snowball-streak">0</strong></span>
              </div>
              <div class="controls">
                <label class="toggle" for="snowball-sfx">
                  <input type="checkbox" id="snowball-sfx" checked />
                  <span>Playful SFX</span>
                </label>
                <button class="btn" id="snowball-start" type="button">Start tossing</button>
              </div>
            </div>
            <canvas
              id="snowball-canvas"
              class="game-canvas"
              width="640"
              height="360"
              aria-label="Snowball Toss playfield"
              tabindex="0"
            ></canvas>
            <p class="hint">Targets speed up as you score. Hit streaks to get bonus points.</p>
          </div>
        </div>
      </div>

      <div class="modal" id="ornament-modal" role="dialog" aria-modal="true" aria-labelledby="ornament-title" hidden>
        <div class="modal-panel frosted-panel">
          <div class="modal-header">
            <div>
              <p class="badge">Balance</p>
              <h3 id="ornament-title">Ornament Stacker</h3>
              <p class="section-subtitle">Catch and steady ornaments before the stack wobbles.</p>
            </div>
            <button class="btn tertiary close" type="button" data-target="ornament-modal" aria-label="Close Ornament Stacker">Ã—</button>
          </div>
          <div class="game-shell">
            <div class="game-toolbar">
              <div class="scoreboard" aria-live="polite">
                <span>Stacked: <strong id="ornament-count">0</strong>/10</span>
                <span>Status: <strong id="ornament-status">Ready</strong></span>
              </div>
              <div class="controls">
                <button class="btn" id="ornament-reset" type="button">Reset stack</button>
              </div>
            </div>
            <canvas
              id="ornament-canvas"
              class="game-canvas"
              width="640"
              height="360"
              aria-label="Ornament stack playfield"
              tabindex="0"
            ></canvas>
            <p class="hint">Press space or tap the canvas to drop an ornament. Keep the tower upright to win.</p>
          </div>
        </div>
      </div>

      <div class="modal" id="matcher-modal" role="dialog" aria-modal="true" aria-labelledby="matcher-title" hidden>
        <div class="modal-panel frosted-panel">
          <div class="modal-header">
            <div>
              <p class="badge">Memory</p>
              <h3 id="matcher-title">Gift Matcher</h3>
              <p class="section-subtitle">Flip pairs, count your moves, and beat the clock.</p>
            </div>
            <button class="btn tertiary close" type="button" data-target="matcher-modal" aria-label="Close Gift Matcher">Ã—</button>
          </div>
          <div class="game-shell matcher-shell">
            <div class="game-toolbar">
              <div class="scoreboard" aria-live="polite">
                <span>Moves: <strong id="matcher-moves">0</strong></span>
                <span>Time: <strong id="matcher-time">0s</strong></span>
              </div>
              <div class="controls">
                <button class="btn" id="matcher-reset" type="button">Shuffle</button>
              </div>
            </div>
            <div class="matcher-grid" id="matcher-grid" role="grid" aria-label="Gift Matcher board"></div>
            <div class="celebration" id="matcher-celebrate" aria-live="polite" hidden>
              <p class="card-title">All matched! ðŸŽ‰</p>
              <p class="hint">Snowfall of confetti incoming.</p>
            </div>
          </div>
        </div>
      </div>

      <section class="section" id="guestbook">
        <div class="container">
          <h2 class="section-title">Sign the guestbook</h2>
          <p class="section-subtitle">
            Leave a note for the hosts or greet fellow guests.
          </p>
          <div class="guestbook">
            <form class="frosted-panel guestbook-form" id="guestbook-form" novalidate>
              <div class="field">
                <div class="label-row">
                  <label for="name">Name</label>
                  <span class="chip" aria-hidden="true">Required</span>
                </div>
                <input
                  id="name"
                  name="name"
                  type="text"
                  placeholder="Your name"
                  autocomplete="name"
                  required
                  aria-describedby="name-error"
                />
                <p class="field-error" id="name-error" role="alert"></p>
              </div>

              <div class="field">
                <div class="label-row">
                  <label for="email">Email</label>
                  <span class="chip subtle" aria-hidden="true">Optional</span>
                </div>
                <input
                  id="email"
                  name="email"
                  type="email"
                  placeholder="you@example.com"
                  autocomplete="email"
                  aria-describedby="email-hint email-error"
                />
                <p class="field-hint" id="email-hint">
                  We only use this to show your avatar letter.
                </p>
                <p class="field-error" id="email-error" role="alert"></p>
              </div>

              <div class="field">
                <div class="label-row">
                  <label for="message">Message</label>
                  <span class="chip subtle" aria-hidden="true">Share some joy</span>
                </div>
                <textarea
                  id="message"
                  name="message"
                  rows="4"
                  placeholder="Send a cozy note to the lounge"
                  required
                  aria-describedby="message-error"
                ></textarea>
                <p class="field-error" id="message-error" role="alert"></p>
              </div>

              <div class="form-actions">
                <button class="btn" type="submit">Send warm wishes</button>
                <button class="btn tertiary" type="button" id="clear-guestbook">
                  Clear entries
                </button>
              </div>
              <p class="field-hint">Entries are saved to your device so you can revisit them.</p>
            </form>
            <div class="frosted-panel guestbook-feed">
              <div class="feed-header">
                <h3 class="card-title">Latest notes</h3>
                <p class="hint">Fresh greetings appear here with avatars.</p>
              </div>
              <ul class="entry-list" id="guestbook-list" aria-live="polite"></ul>
            </div>
          </div>
          <div class="toast" id="guestbook-toast" role="status" aria-live="polite" hidden>
            <span class="toast-icon" aria-hidden="true">âœ¨</span>
            <span id="toast-message">Warm wishes sent!</span>
          </div>
        </div>
      </section>
    </main>

    <footer>
      <div class="container">
        <p class="section-title footer-title">Share the joy</p>
        <p class="section-subtitle footer-subtitle">
          Spread this experience with friends.
        </p>
        <ul class="share-buttons" aria-label="Share this page">
          <li><a href="#">Share on X</a></li>
          <li><a href="#">Share on Instagram</a></li>
          <li><a href="#">Copy invite link</a></li>
        </ul>
      </div>
    </footer>

    <script>
      const body = document.body;

      (() => {
        const track = document.querySelector('.carousel-track');
        const slides = Array.from(track?.children ?? []);
        const prevBtn = document.getElementById('prev-slide');
        const nextBtn = document.getElementById('next-slide');
        const playToggle = document.getElementById('play-toggle');
        const chimeToggle = document.getElementById('chime-toggle');
        const preferenceHint = document.getElementById('preference-hint');
        const customName = document.getElementById('custom-name');
        const customMessage = document.getElementById('custom-message');
        const customApply = document.getElementById('apply-card');
        const customCard = document.getElementById('custom-card');
        const customTitle = document.getElementById('custom-title');
        const customMeta = document.getElementById('custom-meta');
        const customBody = document.getElementById('custom-body');

        if (!track || slides.length === 0) return;

        let current = 0;
        let autoplay = true;
        let autoplayTimer;
        let isPointerDown = false;
        let startX = 0;
        let prefersMotionReduced = window.matchMedia('(prefers-reduced-motion: reduce)');
        let prefersDataReduced = window.matchMedia('(prefers-reduced-data: reduce)');
        let prefersReducedTransparency = window.matchMedia(
          '(prefers-reduced-transparency: reduce)'
        );
        const isAudioRestricted = () =>
          prefersMotionReduced.matches ||
          prefersDataReduced.matches ||
          prefersReducedTransparency.matches ||
          body.classList.contains('audio-muted');

        const audioContext = window.AudioContext ? new AudioContext() : null;
        const playChime = () => {
          if (!audioContext || isAudioRestricted() || !chimeToggle.checked) return;
          if (audioContext.state === 'suspended') {
            audioContext.resume().catch(() => {});
          }

          const now = audioContext.currentTime;
          const osc = audioContext.createOscillator();
          const gain = audioContext.createGain();

          osc.type = 'sine';
          osc.frequency.setValueAtTime(880, now);
          osc.frequency.exponentialRampToValueAtTime(1760, now + 0.35);

          gain.gain.setValueAtTime(0.001, now);
          gain.gain.exponentialRampToValueAtTime(0.12, now + 0.05);
          gain.gain.exponentialRampToValueAtTime(0.0001, now + 0.6);

          osc.connect(gain);
          gain.connect(audioContext.destination);

          osc.start(now);
          osc.stop(now + 0.7);
        };

        const announcePreference = () => {
          const hints = [];
          if (prefersMotionReduced.matches) hints.push('autoplay paused for reduced-motion preference');
          if (prefersDataReduced.matches) hints.push('audio muted to respect reduced-data');
          if (prefersReducedTransparency.matches)
            hints.push('audio muted for reduced-transparency preference');
          if (body.classList.contains('audio-muted')) hints.push('audio muted by preference');
          preferenceHint.textContent = hints.join(' Â· ');
        };

        if (isAudioRestricted()) {
          chimeToggle.checked = false;
          chimeToggle.disabled = true;
          chimeToggle.dataset.locked = 'true';
        }

        if (prefersMotionReduced.matches) {
          autoplay = false;
          playToggle.textContent = 'Play autoplay';
          playToggle.setAttribute('aria-pressed', 'false');
        }

        announcePreference();

        const updateSlides = (focus = false) => {
          slides.forEach((slide, index) => {
            const isActive = index === current;
            slide.classList.toggle('active', isActive);
            slide.setAttribute('aria-hidden', !isActive);
            slide.setAttribute('tabindex', isActive ? '0' : '-1');
          });
          track.style.transform = `translateX(-${current * 100}%)`;

          if (focus) {
            slides[current].focus({ preventScroll: false });
          }

          playChime();
        };

        const goToSlide = (index, focus = false) => {
          current = (index + slides.length) % slides.length;
          updateSlides(focus);
          restartAutoplay();
        };

        const restartAutoplay = () => {
          clearInterval(autoplayTimer);
          if (!autoplay) return;
          autoplayTimer = setInterval(() => goToSlide(current + 1), 5500);
        };

        const toggleAutoplay = () => {
          autoplay = !autoplay;
          playToggle.setAttribute('aria-pressed', String(autoplay));
          playToggle.textContent = autoplay ? 'Pause autoplay' : 'Play autoplay';
          if (autoplay && !prefersMotionReduced.matches) {
            restartAutoplay();
          } else {
            clearInterval(autoplayTimer);
          }
        };

        const handlePointerUp = (clientX) => {
          const delta = clientX - startX;
          if (Math.abs(delta) > 40) {
            goToSlide(delta < 0 ? current + 1 : current - 1);
          }
          isPointerDown = false;
        };

        nextBtn?.addEventListener('click', () => goToSlide(current + 1, true));
        prevBtn?.addEventListener('click', () => goToSlide(current - 1, true));
        playToggle?.addEventListener('click', toggleAutoplay);

        track.addEventListener('pointerdown', (event) => {
          isPointerDown = true;
          startX = event.clientX;
        });

        track.addEventListener('pointermove', (event) => {
          if (!isPointerDown) return;
          if (event.pointerType === 'touch') {
            event.preventDefault();
          }
        });

        track.addEventListener('pointerup', (event) => handlePointerUp(event.clientX));
        track.addEventListener('pointercancel', () => (isPointerDown = false));

        track.addEventListener('keydown', (event) => {
          if (event.key === 'ArrowRight') {
            event.preventDefault();
            goToSlide(current + 1, true);
          }
          if (event.key === 'ArrowLeft') {
            event.preventDefault();
            goToSlide(current - 1, true);
          }
        });

        customApply?.addEventListener('click', () => {
          const name = (customName?.value || 'Your name here').trim();
          const message = (customMessage?.value || 'Share a cozy wish and see it shine.').trim();
          customTitle.textContent = name || 'Your name here';
          customMeta.textContent = name ? `From ${name}` : 'Personal touch';
          customBody.textContent = message;
          customCard?.setAttribute('aria-label', `${name || 'Your'} custom card`);
          goToSlide(slides.indexOf(customCard), true);
        });

        document.addEventListener('visibilitychange', () => {
          if (document.hidden) {
            clearInterval(autoplayTimer);
          } else if (autoplay) {
            restartAutoplay();
          }
        });

        prefersMotionReduced.addEventListener('change', (event) => {
          autoplay = !event.matches;
          playToggle.setAttribute('aria-pressed', String(autoplay));
          playToggle.textContent = autoplay ? 'Pause autoplay' : 'Play autoplay';
          if (autoplay) restartAutoplay();
          else clearInterval(autoplayTimer);
          announcePreference();
        });

        prefersDataReduced.addEventListener('change', () => {
          if (prefersDataReduced.matches || isAudioRestricted()) {
            chimeToggle.checked = false;
            chimeToggle.disabled = true;
            if (muteAudioToggle) {
              muteAudioToggle.checked = true;
              syncAudioToggles();
            }
          } else {
            chimeToggle.disabled = false;
          }
          announcePreference();
        });

        prefersReducedTransparency.addEventListener('change', () => {
          if (prefersReducedTransparency.matches || isAudioRestricted()) {
            chimeToggle.checked = false;
            chimeToggle.disabled = true;
            chimeToggle.dataset.locked = 'true';
            if (muteAudioToggle) {
              muteAudioToggle.checked = true;
              syncAudioToggles();
            }
          } else {
            chimeToggle.disabled = false;
            delete chimeToggle.dataset.locked;
          }
          announcePreference();
        });

        updateSlides();
        if (autoplay) restartAutoplay();
      })();
      const prefersReducedMotion = window.matchMedia(
        "(prefers-reduced-motion: reduce)"
      );
      const reducedMotionToggle = document.getElementById("reduced-motion-toggle");
      const staticArtToggle = document.getElementById("static-art-toggle");
      const muteAudioToggle = document.getElementById("mute-audio-toggle");
      const snowballSfxToggle = document.getElementById("snowball-sfx");
      const chimeToggleGlobal = document.getElementById("chime-toggle");

      const scene = document.querySelector(".parallax-scene");
      const hero = document.querySelector("header.hero");
      const layers = Array.from(scene?.querySelectorAll(".layer") || []);
      let heroEffectsLoaded = false;
      let snowInitialized = false;

      function applyParallax() {
        if (
          !scene ||
          prefersReducedMotion.matches ||
          body.classList.contains("reduced-motion") ||
          body.classList.contains("static-scene")
        )
          return;

        const rect = scene.getBoundingClientRect();
        const centerY = rect.top + rect.height / 2;
        const scrollY = window.innerHeight / 2 - centerY;

        layers.forEach((layer) => {
          const depth = Number(layer.dataset.depth || 0);
          const translateY = scrollY * depth * 0.35;
          layer.style.transform = `translate3d(0, ${translateY}px, 0)`;
        });

        requestAnimationFrame(applyParallax);
      }

      const snowCanvas = document.getElementById("snow-canvas");
      const snowFallback = document.querySelector(".snow-fallback");

      function supportsWebGL() {
        try {
          const canvas = document.createElement("canvas");
          return !!(
            window.WebGLRenderingContext &&
            (canvas.getContext("webgl") || canvas.getContext("experimental-webgl"))
          );
        } catch (err) {
          return false;
        }
      }

      function initSnowCanvas() {
        if (snowInitialized) return;
        if (
          !snowCanvas ||
          prefersReducedMotion.matches ||
          body.classList.contains("reduced-motion") ||
          body.classList.contains("static-scene") ||
          !supportsWebGL()
        ) {
          snowCanvas?.setAttribute("hidden", "true");
          snowFallback?.removeAttribute("hidden");
          return initFallbackSnow();
        }

        snowInitialized = true;

        const ctx = snowCanvas.getContext("2d");
        const flakes = Array.from({ length: 180 }, () => ({
          x: Math.random() * window.innerWidth,
          y: Math.random() * window.innerHeight,
          r: Math.random() * 3 + 1,
          s: Math.random() * 0.6 + 0.4,
        }));

        function resize() {
          snowCanvas.width = window.innerWidth;
          snowCanvas.height = scene.offsetHeight + 200;
        }

        function draw() {
          if (
            prefersReducedMotion.matches ||
            body.classList.contains("reduced-motion") ||
            body.classList.contains("static-scene")
          ) {
            requestAnimationFrame(draw);
            return;
          }
          ctx.clearRect(0, 0, snowCanvas.width, snowCanvas.height);
          ctx.fillStyle = "rgba(255, 255, 255, 0.9)";
          flakes.forEach((flake) => {
            ctx.beginPath();
            ctx.arc(flake.x, flake.y, flake.r, 0, Math.PI * 2);
            ctx.fill();

            flake.y += flake.s * 3;
            flake.x += Math.sin(flake.y * 0.01) * 0.6;

            if (flake.y > snowCanvas.height) {
              flake.y = -flake.r;
              flake.x = Math.random() * snowCanvas.width;
            }
          });

          requestAnimationFrame(draw);
        }

        window.addEventListener("resize", resize);
        resize();
        draw();
      }

      function initFallbackSnow() {
        if (!snowFallback) return;
        snowFallback.querySelectorAll(".flake").forEach((flake, index) => {
          flake.style.setProperty("--delay", `${index * 1.2}s`);
        });
      }

      const updateStaticScene = () => {
        const preferStatic =
          body.classList.contains("reduced-motion") ||
          staticArtToggle?.checked ||
          prefersReducedMotion.matches;
        if (staticArtToggle) {
          staticArtToggle.checked = preferStatic;
        }
        body.classList.toggle("static-scene", preferStatic);
        if (preferStatic) {
          snowCanvas?.setAttribute("hidden", "true");
          snowFallback?.setAttribute("hidden", "true");
          layers.forEach((layer) => (layer.style.transform = ""));
        } else if (heroEffectsLoaded) {
          snowFallback?.setAttribute("hidden", "true");
          snowCanvas?.removeAttribute("hidden");
        }
      };

      const syncAudioToggles = () => {
        const muted = muteAudioToggle?.checked || false;
        body.classList.toggle("audio-muted", Boolean(muted));
        [chimeToggleGlobal, snowballSfxToggle].forEach((input) => {
          if (!input) return;
          if (muted) {
            input.checked = false;
            input.disabled = true;
          } else if (!input.dataset.locked) {
            input.disabled = false;
          }
        });
      };

      const setReducedMotion = (value) => {
        body.classList.toggle("reduced-motion", value);
        updateStaticScene();
      };

      const syncReducedMotionToggle = () => {
        if (reducedMotionToggle) {
          reducedMotionToggle.checked =
            body.classList.contains("reduced-motion") || prefersReducedMotion.matches;
        }
      };

      function initBottle() {
        const bottle = document.querySelector(".bottle-3d");
        if (!bottle) return;
        bottle.classList.toggle("reduced", prefersReducedMotion.matches || body.classList.contains("reduced-motion"));
      }

      const startHeroEffects = () => {
        if (heroEffectsLoaded || body.classList.contains("static-scene")) return;
        heroEffectsLoaded = true;
        initBottle();
        initSnowCanvas();
        requestAnimationFrame(applyParallax);
      };

      if ("IntersectionObserver" in window && hero) {
        const heroObserver = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                startHeroEffects();
                heroObserver.disconnect();
              }
            });
          },
          { threshold: 0.25 }
        );
        heroObserver.observe(hero);
      } else {
        startHeroEffects();
      }

      window.addEventListener("scroll", () => {
        if (!prefersReducedMotion.matches && !body.classList.contains("static-scene")) {
          requestAnimationFrame(applyParallax);
        }
      });

      prefersReducedMotion.addEventListener("change", (event) => {
        setReducedMotion(event.matches);
        syncReducedMotionToggle();
        if (!event.matches) startHeroEffects();
      });

      reducedMotionToggle?.addEventListener("change", (event) => {
        setReducedMotion(event.target.checked);
        if (!event.target.checked) startHeroEffects();
      });

      staticArtToggle?.addEventListener("change", () => {
        updateStaticScene();
        if (!body.classList.contains("static-scene")) startHeroEffects();
      });

      muteAudioToggle?.addEventListener("change", syncAudioToggles);

      setReducedMotion(prefersReducedMotion.matches);
      syncReducedMotionToggle();
      updateStaticScene();
      syncAudioToggles();

      // Mini-game hub logic
      const launchButtons = Array.from(document.querySelectorAll(".launch"));
      const closeButtons = Array.from(document.querySelectorAll(".modal .close"));

      const openModal = (id) => {
        const modal = document.getElementById(id);
        if (!modal) return;
        modal.hidden = false;
        const focusable = modal.querySelector("button, [tabindex='0']");
        focusable?.focus({ preventScroll: false });
        if (id === "snowball-modal") snowballGame.reset();
        if (id === "ornament-modal") ornamentGame.reset();
        if (id === "matcher-modal") giftMatcher.reset();
      };

      const closeModal = (id) => {
        const modal = document.getElementById(id);
        if (!modal) return;
        modal.hidden = true;
        if (id === "snowball-modal") snowballGame.stop();
        if (id === "ornament-modal") ornamentGame.stop();
        if (id === "matcher-modal" && giftMatcher?.timer) {
          clearInterval(giftMatcher.timer);
        }
      };

      launchButtons.forEach((button) => {
        button.addEventListener("click", () => openModal(button.dataset.target));
        button.addEventListener("keydown", (event) => {
          if (event.key === "Enter") openModal(button.dataset.target);
        });
      });

      closeButtons.forEach((button) => {
        button.addEventListener("click", () => closeModal(button.dataset.target));
      });

      document.querySelectorAll(".modal").forEach((modal) => {
        modal.addEventListener("click", (event) => {
          if (event.target === modal) closeModal(modal.id);
        });
      });

      document.addEventListener("keydown", (event) => {
        if (event.key === "Escape") {
          document
            .querySelectorAll(".modal:not([hidden])")
            .forEach((modal) => closeModal(modal.id));
        }
      });

      // Guestbook form & entries
      const guestbookForm = document.getElementById("guestbook-form");
      const guestbookList = document.getElementById("guestbook-list");
      const clearGuestbook = document.getElementById("clear-guestbook");
      const toast = document.getElementById("guestbook-toast");
      const toastMessage = document.getElementById("toast-message");
      const nameField = document.getElementById("name");
      const emailField = document.getElementById("email");
      const messageField = document.getElementById("message");
      const nameError = document.getElementById("name-error");
      const emailError = document.getElementById("email-error");
      const messageError = document.getElementById("message-error");

      const guestbookStorageKey = "holiday-guestbook";
      const defaultEntries = [
        {
          name: "Alex",
          email: "alex@northpole.com",
          message: "Can't wait for the gingerbread showdown!",
          createdAt: Date.now() - 1000 * 60 * 60 * 5,
        },
        {
          name: "Rin",
          email: "",
          message: "Saving a spot by the fire for everyone.",
          createdAt: Date.now() - 1000 * 60 * 60 * 2,
        },
        {
          name: "Lee",
          email: "lee@festive.fm",
          message: "This guestbook is the coziest corner.",
          createdAt: Date.now() - 1000 * 60 * 30,
        },
      ];

      const storageAvailable = (() => {
        try {
          const key = "guestbook-check";
          localStorage.setItem(key, "ok");
          localStorage.removeItem(key);
          return true;
        } catch (error) {
          return false;
        }
      })();

      const loadEntries = () => {
        if (!storageAvailable) return [...defaultEntries];
        try {
          const saved = JSON.parse(localStorage.getItem(guestbookStorageKey));
          if (Array.isArray(saved)) return saved;
          return [...defaultEntries];
        } catch (error) {
          return [...defaultEntries];
        }
      };

      let guestbookEntries = loadEntries();

      const saveEntries = () => {
        if (!storageAvailable) return;
        localStorage.setItem(guestbookStorageKey, JSON.stringify(guestbookEntries));
      };

      const getInitials = (name) =>
        name
          .split(/\s+/)
          .filter(Boolean)
          .map((part) => part[0])
          .slice(0, 2)
          .join("")
          .toUpperCase();

      const avatarPalette = [
        "linear-gradient(135deg, #e41e26, #f07878)",
        "linear-gradient(135deg, #8f0f16, #ff8a80)",
        "linear-gradient(135deg, #f59e0b, #facc15)",
        "linear-gradient(135deg, #2563eb, #7c3aed)",
        "linear-gradient(135deg, #10b981, #22c55e)",
      ];

      const getAvatarStyle = (name) => {
        const label = name || "Guest";
        const index = Math.abs(label.charCodeAt(0) + label.length) % avatarPalette.length;
        return avatarPalette[index];
      };

      const renderEntries = () => {
        if (!guestbookList) return;
        guestbookList.innerHTML = "";

        if (!guestbookEntries.length) {
          const empty = document.createElement("p");
          empty.className = "empty-state";
          empty.textContent = "No notes yet. Be the first to send warm wishes.";
          guestbookList.appendChild(empty);
          return;
        }

        guestbookEntries
          .slice()
          .sort((a, b) => b.createdAt - a.createdAt)
          .forEach((entry) => {
            const item = document.createElement("li");
            item.className = "entry";

            const avatar = document.createElement("div");
            avatar.className = "avatar";
            avatar.style.background = getAvatarStyle(entry.name);
            avatar.textContent = getInitials(entry.name || "?");

            const content = document.createElement("div");
            const title = document.createElement("h4");
            title.textContent = entry.name || "Guest";

            const meta = document.createElement("p");
            meta.className = "meta";
            const timestamp = new Date(entry.createdAt || Date.now()).toLocaleString("en-US", {
              month: "short",
              day: "numeric",
              hour: "numeric",
              minute: "2-digit",
            });
            meta.textContent = `Shared on ${timestamp}`;

            const bodyText = document.createElement("p");
            bodyText.className = "body";
            bodyText.textContent = entry.message;

            content.appendChild(title);
            content.appendChild(meta);

            if (entry.email) {
              const contact = document.createElement("p");
              contact.className = "contact";
              contact.innerHTML =
                '<svg aria-hidden="true" focusable="false" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6h16v12H4z"></path><path d="m4 6 8 7 8-7"></path></svg>';
              const emailText = document.createElement("span");
              emailText.textContent = entry.email;
              contact.appendChild(emailText);
              content.appendChild(contact);
            }

            content.appendChild(bodyText);
            item.appendChild(avatar);
            item.appendChild(content);
            guestbookList.appendChild(item);
          });
      };

      const showToast = (message) => {
        if (!toast || !toastMessage) return;
        toastMessage.textContent = message;
        toast.hidden = false;
        toast.classList.remove("visible");
        const duration = body.classList.contains("reduced-motion") || prefersReducedMotion.matches ? 1200 : 2400;
        requestAnimationFrame(() => toast.classList.add("visible"));
        setTimeout(() => {
          toast.classList.remove("visible");
          setTimeout(() => {
            toast.hidden = true;
          }, 320);
        }, duration);
      };

      const clearErrors = () => {
        if (nameError) nameError.textContent = "";
        if (emailError) emailError.textContent = "";
        if (messageError) messageError.textContent = "";
      };

      guestbookForm?.addEventListener("submit", (event) => {
        event.preventDefault();
        clearErrors();
        const name = nameField?.value.trim();
        const email = emailField?.value.trim();
        const message = messageField?.value.trim();
        let valid = true;

        if (!name) {
          nameError.textContent = "Please share your name so we can celebrate you.";
          nameField?.focus();
          valid = false;
        }

        if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
          emailError.textContent = "Enter a valid email or leave this blank.";
          if (valid) emailField?.focus();
          valid = false;
        }

        if (!message) {
          messageError.textContent = "Please add a short message.";
          if (valid) messageField?.focus();
          valid = false;
        }

        if (!valid) return;

        guestbookEntries.push({
          name,
          email,
          message,
          createdAt: Date.now(),
        });
        saveEntries();
        renderEntries();
        guestbookForm.reset();
        showToast("Your warm wishes were added.");
      });

      [nameField, emailField, messageField].forEach((field) => {
        field?.addEventListener("input", () => {
          if (!field.value.trim()) return;
          clearErrors();
        });
      });

      clearGuestbook?.addEventListener("click", () => {
        guestbookEntries = [];
        saveEntries();
        renderEntries();
        showToast("Guestbook cleared.");
      });

      renderEntries();

      // Snowball Toss
      const snowballCanvas = document.getElementById("snowball-canvas");
      const snowballCtx = snowballCanvas?.getContext("2d");
      const snowballScoreEl = document.getElementById("snowball-score");
      const snowballStreakEl = document.getElementById("snowball-streak");
      const snowballStart = document.getElementById("snowball-start");
      const snowballSfx = document.getElementById("snowball-sfx");

      const snowballGame = {
        running: false,
        score: 0,
        streak: 0,
        targets: [],
        audio: window.AudioContext ? new AudioContext() : null,
        reset() {
          this.score = 0;
          this.streak = 0;
          this.targets = Array.from({ length: 6 }, () => this.spawnTarget());
          this.running = true;
          this.loop();
          this.render();
          snowballScoreEl.textContent = this.score;
          snowballStreakEl.textContent = this.streak;
        },
        stop() {
          this.running = false;
        },
        spawnTarget() {
          const size = Math.random() * 12 + 18;
          return {
            x: Math.random() * snowballCanvas.width,
            y: Math.random() * snowballCanvas.height,
            r: size,
            vx: (Math.random() * 2 + 1) * (Math.random() > 0.5 ? 1 : -1),
            vy: (Math.random() * 2 + 1) * (Math.random() > 0.5 ? 1 : -1),
            hue: Math.random() * 40 + 340,
          };
        },
        loop() {
          if (!this.running) return;
          this.update();
          this.render();
          requestAnimationFrame(() => this.loop());
        },
        update() {
          const speedBoost = 1 + this.score * 0.02;
          this.targets.forEach((t) => {
            t.x += t.vx * speedBoost;
            t.y += t.vy * speedBoost;
            if (t.x - t.r < 0 || t.x + t.r > snowballCanvas.width) t.vx *= -1;
            if (t.y - t.r < 0 || t.y + t.r > snowballCanvas.height) t.vy *= -1;
          });
        },
        render() {
          if (!snowballCtx) return;
          snowballCtx.clearRect(0, 0, snowballCanvas.width, snowballCanvas.height);
          this.targets.forEach((t) => {
            const gradient = snowballCtx.createRadialGradient(
              t.x - t.r * 0.3,
              t.y - t.r * 0.3,
              6,
              t.x,
              t.y,
              t.r
            );
            gradient.addColorStop(0, `hsla(${t.hue}, 90%, 80%, 0.95)`);
            gradient.addColorStop(1, `hsla(${t.hue}, 80%, 60%, 0.75)`);
            snowballCtx.fillStyle = gradient;
            snowballCtx.beginPath();
            snowballCtx.arc(t.x, t.y, t.r, 0, Math.PI * 2);
            snowballCtx.fill();
            snowballCtx.strokeStyle = "rgba(255,255,255,0.8)";
            snowballCtx.lineWidth = 2;
            snowballCtx.stroke();
          });
        },
        hit(clientX, clientY) {
          const rect = snowballCanvas.getBoundingClientRect();
          const scaleX = snowballCanvas.width / rect.width;
          const scaleY = snowballCanvas.height / rect.height;
          const x = (clientX - rect.left) * scaleX;
          const y = (clientY - rect.top) * scaleY;
          let hitSomething = false;
          this.targets = this.targets.map((t) => {
            const dist = Math.hypot(t.x - x, t.y - y);
            if (dist <= t.r) {
              hitSomething = true;
              const bonus = Math.max(1, Math.floor(this.streak / 3));
              this.score += 10 + bonus;
              this.streak += 1;
              snowballScoreEl.textContent = this.score;
              snowballStreakEl.textContent = this.streak;
              this.playPop();
              return this.spawnTarget();
            }
            return t;
          });
          if (!hitSomething) {
            this.streak = 0;
            snowballStreakEl.textContent = this.streak;
          }
        },
        playPop() {
          if (
            !snowballSfx?.checked ||
            body.classList.contains("reduced-motion") ||
            body.classList.contains("audio-muted")
          )
            return;
          if (!this.audio) return;
          if (this.audio.state === "suspended") this.audio.resume();
          const now = this.audio.currentTime;
          const osc = this.audio.createOscillator();
          const gain = this.audio.createGain();
          osc.type = "triangle";
          osc.frequency.setValueAtTime(520, now);
          osc.frequency.exponentialRampToValueAtTime(880, now + 0.12);
          gain.gain.setValueAtTime(0.001, now);
          gain.gain.exponentialRampToValueAtTime(0.18, now + 0.04);
          gain.gain.exponentialRampToValueAtTime(0.0001, now + 0.35);
          osc.connect(gain);
          gain.connect(this.audio.destination);
          osc.start(now);
          osc.stop(now + 0.4);
        },
      };

      snowballCanvas?.addEventListener("pointerdown", (event) => snowballGame.hit(event.clientX, event.clientY));
      snowballStart?.addEventListener("click", () => snowballGame.reset());
      snowballCanvas?.addEventListener("keydown", (event) => {
        if (event.key === "Enter" || event.key === " ") {
          event.preventDefault();
          const rect = snowballCanvas.getBoundingClientRect();
          snowballGame.hit(rect.left + rect.width / 2, rect.top + rect.height / 2);
        }
      });

      // Ornament Stacker
      const ornamentCanvas = document.getElementById("ornament-canvas");
      const ornamentCtx = ornamentCanvas?.getContext("2d");
      const ornamentCountEl = document.getElementById("ornament-count");
      const ornamentStatusEl = document.getElementById("ornament-status");
      const ornamentReset = document.getElementById("ornament-reset");

      const ornamentGame = {
        running: false,
        ornaments: [],
        active: null,
        dropper: { x: 0, direction: 1 },
        targetCount: 10,
        gravity: 0.4,
        reset() {
          this.ornaments = [];
          this.running = true;
          this.active = null;
          this.dropper.x = ornamentCanvas.width / 2;
          ornamentStatusEl.textContent = "Ready";
          ornamentCountEl.textContent = "0";
          this.loop();
        },
        stop() {
          this.running = false;
        },
        loop() {
          if (!this.running) return;
          this.update();
          this.render();
          requestAnimationFrame(() => this.loop());
        },
        update() {
          const swingSpeed = body.classList.contains("reduced-motion") ? 0.8 : 1.4;
          this.dropper.x += this.dropper.direction * swingSpeed;
          if (this.dropper.x < 30 || this.dropper.x > ornamentCanvas.width - 30) {
            this.dropper.direction *= -1;
          }

          if (this.active) {
            this.active.vy += this.gravity;
            this.active.y += this.active.vy;
            const landingY = ornamentCanvas.height - this.active.r - 12;
            const topPiece = this.ornaments[this.ornaments.length - 1];
            const targetY = topPiece ? topPiece.y - topPiece.r - this.active.r : landingY;
            if (this.active.y >= targetY) {
              this.active.y = targetY;
              this.ornaments.push(this.active);
              ornamentCountEl.textContent = this.ornaments.length;
              this.active = null;
              this.checkOutcome();
            }
          }
        },
        render() {
          if (!ornamentCtx) return;
          ornamentCtx.clearRect(0, 0, ornamentCanvas.width, ornamentCanvas.height);
          ornamentCtx.fillStyle = "#f5f5ff";
          ornamentCtx.fillRect(0, ornamentCanvas.height - 12, ornamentCanvas.width, 16);
          this.ornaments.forEach((o, index) => this.drawOrnament(o, index));
          if (this.active) this.drawOrnament(this.active, this.ornaments.length);
          this.drawDropper();
        },
        drawDropper() {
          ornamentCtx.fillStyle = "rgba(228, 30, 38, 0.35)";
          ornamentCtx.fillRect(this.dropper.x - 2, 10, 4, 50);
          ornamentCtx.beginPath();
          ornamentCtx.arc(this.dropper.x, 60, 8, 0, Math.PI * 2);
          ornamentCtx.fill();
        },
        drawOrnament(o, index) {
          const colors = ["#fdf1f1", "#ffe7d9", "#dff0ff", "#fff9d6"];
          ornamentCtx.beginPath();
          ornamentCtx.fillStyle = colors[index % colors.length];
          ornamentCtx.strokeStyle = "rgba(0,0,0,0.08)";
          ornamentCtx.lineWidth = 2;
          ornamentCtx.arc(o.x, o.y, o.r, 0, Math.PI * 2);
          ornamentCtx.fill();
          ornamentCtx.stroke();
          ornamentCtx.fillStyle = "rgba(228, 30, 38, 0.65)";
          ornamentCtx.fillRect(o.x - 6, o.y - o.r - 8, 12, 10);
        },
        drop() {
          if (!this.running || this.active) return;
          const radius = Math.random() * 6 + 16;
          this.active = {
            x: this.dropper.x,
            y: 70,
            r: radius,
            vy: 0,
          };
        },
        checkOutcome() {
          if (this.ornaments.length >= this.targetCount) {
            ornamentStatusEl.textContent = "Win!";
            this.running = false;
            return;
          }
          const wobble = this.computeLean();
          if (Math.abs(wobble) > ornamentCanvas.width * 0.22) {
            ornamentStatusEl.textContent = "Tipped over";
            this.running = false;
          } else {
            ornamentStatusEl.textContent = "Stacking";
          }
        },
        computeLean() {
          if (this.ornaments.length === 0) return 0;
          const base = this.ornaments[0].x;
          const top = this.ornaments[this.ornaments.length - 1].x;
          return top - base;
        },
      };

      ornamentCanvas?.addEventListener("click", () => ornamentGame.drop());
      ornamentCanvas?.addEventListener("keydown", (event) => {
        if (event.key === "Enter" || event.key === " ") {
          event.preventDefault();
          ornamentGame.drop();
        }
      });
      document.addEventListener("keydown", (event) => {
        if (!document.getElementById("ornament-modal")?.hidden && event.code === "Space") {
          event.preventDefault();
          ornamentGame.drop();
        }
      });
      ornamentReset?.addEventListener("click", () => ornamentGame.reset());

      // Gift Matcher
      const matcherGrid = document.getElementById("matcher-grid");
      const matcherMoves = document.getElementById("matcher-moves");
      const matcherTime = document.getElementById("matcher-time");
      const matcherReset = document.getElementById("matcher-reset");
      const matcherCelebrate = document.getElementById("matcher-celebrate");

      const matcherIcons = [
        "ðŸŽ",
        "ðŸ§£",
        "â›„",
        "ðŸ§¤",
        "ðŸŽ„",
        "â­",
        "ðŸª",
        "â˜•",
      ];

      const giftMatcher = {
        cards: [],
        first: null,
        moves: 0,
        timer: null,
        timeElapsed: 0,
        reset() {
          this.cards = this.shuffle([...matcherIcons, ...matcherIcons]);
          this.first = null;
          this.moves = 0;
          this.timeElapsed = 0;
          clearInterval(this.timer);
          matcherGrid.innerHTML = "";
          matcherCelebrate.hidden = true;
          matcherMoves.textContent = "0";
          matcherTime.textContent = "0s";
          this.render();
        },
        startTimer() {
          clearInterval(this.timer);
          this.timer = setInterval(() => {
            this.timeElapsed += 1;
            matcherTime.textContent = `${this.timeElapsed}s`;
          }, 1000);
        },
        shuffle(arr) {
          for (let i = arr.length - 1; i > 0; i -= 1) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
          }
          return arr;
        },
        render() {
          this.cards.forEach((icon, index) => {
            const tile = document.createElement("button");
            tile.className = "card-tile";
            tile.setAttribute("role", "gridcell");
            tile.setAttribute("aria-label", "Gift card");
            tile.setAttribute("aria-pressed", "false");
            tile.innerHTML = `
              <span class="face back" aria-hidden="true">ðŸŽ€</span>
              <span class="face front" aria-hidden="true">${icon}</span>
            `;
            tile.addEventListener("click", () => this.flip(tile, icon));
            matcherGrid.appendChild(tile);
          });
        },
        flip(tile, icon) {
          if (tile.classList.contains("matched") || tile.classList.contains("revealed")) return;
          tile.classList.add("revealed");
          tile.setAttribute("aria-pressed", "true");
          if (!this.first) {
            this.first = { tile, icon };
            if (!this.timeElapsed) this.startTimer();
            return;
          }
          this.moves += 1;
          matcherMoves.textContent = this.moves;
          const { tile: firstTile, icon: firstIcon } = this.first;
          if (firstIcon === icon) {
            tile.classList.add("matched");
            firstTile.classList.add("matched");
            tile.setAttribute("aria-pressed", "true");
            firstTile.setAttribute("aria-pressed", "true");
            this.first = null;
            this.checkWin();
          } else {
            setTimeout(() => {
              tile.classList.remove("revealed");
              firstTile.classList.remove("revealed");
              tile.setAttribute("aria-pressed", "false");
              firstTile.setAttribute("aria-pressed", "false");
              this.first = null;
            }, body.classList.contains("reduced-motion") ? 200 : 600);
          }
        },
        checkWin() {
          const allMatched = matcherGrid.querySelectorAll(".matched").length === this.cards.length;
          if (allMatched) {
            clearInterval(this.timer);
            matcherCelebrate.hidden = false;
            if (body.classList.contains("reduced-motion")) {
              matcherCelebrate.style.setProperty("animation", "none");
            }
          }
        },
      };

      matcherReset?.addEventListener("click", () => giftMatcher.reset());
      giftMatcher.reset();
    </script>
  </body>
</html>
